<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SAM â€¢ Multi-Arena Orchestrator</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <button
    id="optionsHandle"
    class="options-handle"
    type="button"
    aria-haspopup="true"
    aria-expanded="false"
    aria-controls="optionsDrawer"
  >
    <span class="options-handle__chevron" aria-hidden="true">â–¸</span>
    <span class="sr-only">Toggle SAM options</span>
  </button>
  <div id="optionsBackdrop" class="options-backdrop" hidden></div>

  <main class="layout">
    <aside id="optionsDrawer" class="side-panel" aria-labelledby="settings-heading" tabindex="-1" aria-hidden="true" inert>
      <section class="side-card" aria-labelledby="arena-heading">
        <header class="side-card__header">
          <h2 id="arena-heading">Arena configuration</h2>
        </header>
        <div class="field">
          <label for="arena_mode">Arena mode</label>
          <select id="arena_mode">
            <option value="human">Human Arena</option>
            <option value="pair">Pair Arena</option>
            <option value="roundtable">Roundtable</option>
            <option value="allout">All-Out</option>
          </select>
        </div>
        <div class="field field--inline">
          <label for="turn_cooldown_ms">Turn cooldown (ms)</label>
          <input id="turn_cooldown_ms" type="number" min="0" value="15000">
        </div>
        <div class="field">
          <label for="board_policy">Board memory policy</label>
          <select id="board_policy">
            <option value="last_k_messages">Last K messages</option>
            <option value="rolling_window_tokens">Rolling token window</option>
            <option value="summary_every_n_turns">Summary every N turns</option>
          </select>
        </div>
        <div class="field field--inline">
          <label for="board_window">Window size / tokens</label>
          <input id="board_window" type="number" min="1" value="20">
        </div>
        <div class="field field--inline" id="summaryEveryField">
          <label for="summary_every">Summaries every N turns</label>
          <input id="summary_every" type="number" min="1" value="5">
        </div>
        <label class="toggle">
          <input id="parallel_mode_toggle" type="checkbox">
          <span>Enable parallel workers (All-Out only)</span>
        </label>
        <div class="participants-header">
          <h3 id="participants-heading">Participants</h3>
          <button id="add_agent_btn" class="ghost" type="button">Add agent</button>
        </div>
        <ol id="agent_list" class="agent-list" aria-labelledby="participants-heading"></ol>
      </section>

      <section class="side-card" aria-labelledby="memory-heading">
        <header class="side-card__header">
          <h2 id="memory-heading">Memory settings</h2>
        </header>
        <p id="memoryStatus" class="status-pill">Floating memory: 0 / 100&nbsp;MB</p>
        <label class="slider-label" for="memorySlider">Floating memory budget <span id="memorySliderValue">100&nbsp;MB</span></label>
        <input id="memorySlider" type="range" min="50" max="200" step="10" value="100">
        <div class="field">
          <label for="retrievalCount">Memories per retrieval (0 = unlimited)</label>
          <input id="retrievalCount" type="number" min="0" max="200" value="0">
        </div>
        <label class="toggle">
          <input id="autoInjectMemories" type="checkbox">
          <span>Auto-inject retrieved memories</span>
        </label>
        <label class="toggle">
          <input id="embeddingRetrievalToggle" type="checkbox">
          <span>Use embeddings for retrieval</span>
        </label>
        <p id="embeddingStatus" class="hint-text" role="status">Embedding Active âœ— (disabled)</p>
        <p id="vectorCacheStatus" class="hint-text" role="status">Vector cache: initialisingâ€¦</p>
        <button id="exportMemoryButton" class="ghost" type="button">Export floating memory</button>
      </section>

      <section class="side-card" aria-labelledby="workbench-heading">
        <header class="side-card__header">
          <h2 id="workbench-heading">Floating memory workbench</h2>
        </header>
        <p class="hint-text">Review the RAM-disk memories that feed retrieval and pin critical notes.</p>
        <dl class="memory-stats" aria-live="polite">
          <div class="memory-stat">
            <dt>Floating</dt>
            <dd id="floatingMemoryCount">0</dd>
          </div>
          <div class="memory-stat">
            <dt>Pinned</dt>
            <dd id="pinnedMemoryCount">0</dd>
          </div>
          <div class="memory-stat">
            <dt>RAG entries</dt>
            <dd id="ragMemoryCount">0</dd>
          </div>
          <div class="memory-stat">
            <dt>RAG footprint</dt>
            <dd id="ragFootprint">0 MB</dd>
          </div>
        </dl>
        <p id="ragImportStatus" class="hint-text" role="status">RAG archives not loaded yet.</p>
        <div id="floatingMemoryList" class="memory-list" role="list"></div>
        <div class="memory-actions">
          <button id="refreshFloatingButton" class="ghost" type="button">Refresh view</button>
          <button id="archiveUnpinnedButton" class="ghost danger" type="button">Archive unpinned</button>
        </div>
      </section>
    </aside>

    <section id="boardPanel" class="board-panel" aria-labelledby="board-heading">
      <header class="panel-header">
        <div class="panel-header__stack">
          <h1 id="board-heading">SAM Bulletin Board</h1>
          <p class="subtitle">Durable arena transcript with floating memory</p>
        </div>
        <div class="board-controls">
          <span id="boardTurnStatus" class="status-pill">Round 0 â€¢ Idle</span>
          <button id="snapshotBoardBtn" class="ghost" type="button">Snapshot now</button>
          <button id="pauseArenaBtn" class="ghost" type="button">Pause</button>
          <button id="resumeArenaBtn" class="ghost" type="button">Resume</button>
        </div>
      </header>
      <div id="boardViewport" class="board-viewport" aria-live="polite"></div>
      <footer class="board-footer">
        <div class="board-footer__left">
          <button id="startArenaBtn" class="primary" type="button">Start arena</button>
          <button id="stopArenaBtn" class="ghost danger" type="button">Stop</button>
          <button id="exportBoardBtn" class="ghost" type="button">Export board</button>
        </div>
        <div class="board-footer__right">
          <label class="toggle">
            <input id="humanInputToggle" type="checkbox">
            <span>Enable human participant input</span>
          </label>
        </div>
      </footer>
    </section>

    <section id="chatPanel" class="chat-panel" aria-labelledby="chat-heading" hidden>
      <header class="panel-header">
        <div class="panel-header__stack">
          <h2 id="chat-heading">Human Arena Input</h2>
          <p class="subtitle">Send a message when it is the human turn</p>
        </div>
      </header>
      <div id="chatWindow" class="chat-window" aria-live="polite"></div>
      <footer class="chat-footer">
        <label class="sr-only" for="messageInput">Message</label>
        <textarea id="messageInput" rows="2" placeholder="Share your thoughts with the arenaâ€¦"></textarea>
        <div class="input-actions">
          <button id="sendButton" class="primary" type="button">Send</button>
          <button id="clearChatButton" class="ghost danger" type="button">Clear</button>
        </div>
      </footer>
    </section>
  </main>

  <template id="agentCardTemplate">
    <li class="agent-card side-card" data-agent-id="">
      <header class="agent-card__header">
        <button class="accordion-toggle" type="button" aria-expanded="false">
          <span class="agent-card__title"></span>
          <span class="chevron" aria-hidden="true">â–¸</span>
        </button>
        <button class="ghost ghost--icon agent-remove" type="button" title="Remove agent">ðŸ—‘</button>
      </header>
      <div class="agent-card__body" hidden>
        <section class="agent-section">
          <h3>Chat model</h3>
          <div class="field">
            <label>Provider</label>
            <select class="agent-model-provider">
              <option value="ollama_local">Ollama (local)</option>
              <option value="ollama_cloud">Ollama Cloud</option>
              <option value="lmstudio">LM Studio</option>
            </select>
          </div>
          <div class="field">
            <label>Preset</label>
            <input class="agent-model-preset" type="text" placeholder="default">
          </div>
          <div class="field">
            <label>Endpoint</label>
            <input class="agent-model-endpoint" type="text" placeholder="http://localhost:11434/api/generate">
          </div>
          <div class="field">
            <label>Model</label>
            <select class="agent-model-name"></select>
          </div>
          <div class="field">
            <label>API key</label>
            <input class="agent-model-key" type="password" autocomplete="off">
          </div>
          <div class="field field--split">
            <label>Temperature</label>
            <input class="agent-model-temp" type="number" min="0" max="2" step="0.1" value="0.7">
          </div>
          <div class="field field--split">
            <label>Max tokens</label>
            <input class="agent-model-max" type="number" min="64" max="32768" value="2048">
          </div>
          <label class="toggle agent-cooldown-toggle">
            <input class="agent-cooldown-check" type="checkbox">
            <span>Custom cooldown (ms)</span>
          </label>
          <div class="field" data-per-agent-cooldown hidden>
            <input class="agent-cooldown-input" type="number" min="0" value="0">
          </div>
          <div class="agent-actions">
            <button class="ghost agent-test-chat" type="button">Test chat</button>
          </div>
        </section>
        <section class="agent-section">
          <h3>Embeddings</h3>
          <div class="field">
            <label>Provider</label>
            <select class="agent-embed-provider">
              <option value="ollama_local">Ollama (local)</option>
              <option value="ollama_cloud">Ollama Cloud</option>
              <option value="lmstudio">LM Studio</option>
            </select>
          </div>
          <div class="field">
            <label>Endpoint</label>
            <input class="agent-embed-endpoint" type="text" placeholder="http://localhost:11434/api/embed">
          </div>
          <div class="field">
            <label>Model</label>
            <select class="agent-embed-model"></select>
          </div>
          <div class="field">
            <label>API key</label>
            <input class="agent-embed-key" type="password" autocomplete="off">
          </div>
          <div class="field field--split">
            <label>Context length</label>
            <input class="agent-embed-ctx" type="number" min="128" max="32768" value="2048">
          </div>
          <div class="agent-actions">
            <button class="ghost agent-test-embed" type="button">Test embed</button>
          </div>
        </section>
        <section class="agent-section">
          <h3>Persona</h3>
          <textarea class="agent-persona" rows="3" placeholder="Describe this agent's role and expertise."></textarea>
        </section>
      </div>
    </li>
  </template>

  <script type="module" src="app.js"></script>
</body>
</html>
